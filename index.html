<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oxford 영어 단어장 마스터 Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f3f4f6;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* Mode Switcher */
        .mode-switcher {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 12px 30px;
            border: 2px solid var(--primary);
            border-radius: 10px;
            background: white;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: var(--primary);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        .btn-icon {
            padding: 8px;
            border-radius: 50%;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.9rem;
        }

        /* File Upload */
        .upload-area {
            border: 3px dashed #d1d5db;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f9fafb;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: #f3f4f6;
        }

        .upload-area.drag-over {
            background: #ede9fe;
            border-color: var(--primary);
        }

        .upload-icon {
            font-size: 3rem;
            color: #9ca3af;
            margin-bottom: 15px;
        }

        /* File List */
        .file-list {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .file-item:hover {
            background: #f3f4f6;
        }

        .file-name {
            font-weight: 500;
            color: var(--dark);
        }

        .file-status {
            color: var(--success);
            font-size: 0.9rem;
        }

        /* Table */
        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #f9fafb;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #6b7280;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .table td {
            padding: 12px;
            border-top: 1px solid #e5e7eb;
        }

        .table tr:hover {
            background: #f9fafb;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Tabs with delete button */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tabs > div {
            display: inline-block;
            position: relative;
        }
        
        .btn-book-delete {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 10;
        }
        
        .btn-book-delete:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .tab:hover {
            background: #f3f4f6;
        }

        .tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Units Grid */
        .units-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .unit-card {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .unit-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .unit-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .unit-subtitle {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .unit-count {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Word Cards */
        .word-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.2s ease;
        }

        .word-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .word-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .word-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }

        .word-pos {
            display: inline-block;
            background: #e0e7ff;
            color: var(--primary);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        .word-meaning {
            font-size: 1.05rem;
            color: #374151;
            margin-bottom: 10px;
        }

        .word-example {
            font-style: italic;
            color: #6b7280;
            font-size: 0.95rem;
            padding: 10px;
            background: #f9fafb;
            border-radius: 6px;
            margin-top: 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.2s ease;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 500px;
            margin: 50px auto;
            padding: 30px;
            position: relative;
            animation: slideIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            display: none;
            animation: slideInRight 0.3s ease;
            z-index: 2000;
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.warning {
            background: var(--warning);
        }

        /* Deploy Mode Notice */
        .deploy-notice {
            background: #e0f2fe;
            border: 1px solid #0284c7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            color: #075985;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        /* Loading Spinner */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f4f6;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Batch Actions */
        .batch-actions {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: #f3f4f6;
            border-radius: 8px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Search Box */
        .search-box {
            position: relative;
            max-width: 400px;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }

        /* Audio Controls */
        .audio-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .audio-btn {
            padding: 8px 16px;
            background: #e0e7ff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            position: relative;
        }

        .audio-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .audio-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .audio-btn.playing {
            background: var(--primary);
            color: white;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* Speech Settings */
        .speech-settings {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            display: none;
            z-index: 100;
        }
        
        .speech-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .speech-control label {
            min-width: 80px;
            font-size: 14px;
        }
        
        .speech-control input[type="range"] {
            width: 150px;
        }
        
        .speech-control span {
            min-width: 50px;
            text-align: right;
            font-size: 14px;
            color: #666;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .units-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
                -webkit-overflow-scrolling: touch;
            }

            .card-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        /* Utilities */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 10px; }
        .mb-2 { margin-bottom: 20px; }
        .mb-3 { margin-bottom: 30px; }
        .mt-2 { margin-top: 20px; }
        .hidden { display: none; }
        .flex { display: flex; }
        .flex-between { justify-content: space-between; }
        .flex-center { align-items: center; }
        .gap-2 { gap: 10px; }
        .gap-3 { gap: 20px; }

        /* Export Options */
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .export-option {
            padding: 20px;
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .export-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .export-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🎓 Oxford 영어 단어장 마스터 Pro</h1>
            <p>AI 기반 스마트 영어 단어 학습 시스템</p>
        </div>

        <!-- Mode Switcher -->
        <div class="mode-switcher">
            <button class="mode-btn" id="editModeBtn" onclick="setMode('edit')">
                👨‍🏫 원장님 모드
            </button>
            <button class="mode-btn active" id="studentModeBtn" onclick="setMode('student')">
                👨‍🎓 학생 모드
            </button>
            <button class="mode-btn" id="studyModeBtn" onclick="setMode('study')">
                🎯 학습 모드
            </button>
        </div>

        <!-- Student Mode Notice -->
        <div id="studentNotice" class="deploy-notice hidden">
            ℹ️ 학생 모드입니다. 파일 업로드 및 편집 기능이 비활성화되어 있습니다.
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalBooks">0</div>
                <div class="stat-label">교재</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalUnits">0</div>
                <div class="stat-label">유닛</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalWords">0</div>
                <div class="stat-label">단어</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgWords">0</div>
                <div class="stat-label">평균 단어/유닛</div>
            </div>
        </div>

        <!-- File Upload -->
        <div class="card" id="uploadCard" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">📂 파일 업로드</h2>
                <div class="flex gap-2">
                    <button class="btn btn-primary btn-sm" onclick="showSampleFormat()">
                        📋 파일 형식 보기
                    </button>
                    <button class="btn btn-warning btn-sm" onclick="exportAllData()">
                        💾 전체 백업
                    </button>
                    <button class="btn btn-danger btn-sm" id="clearDataBtn" onclick="clearAllData()">
                        🗑️ 데이터 초기화
                    </button>
                </div>
            </div>
            
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">📤</div>
                <h3>텍스트 파일을 드래그하여 놓으세요</h3>
                <p>또는 클릭하여 파일 선택</p>
                <input type="file" id="fileInput" accept=".txt,.json" multiple style="display: none;">
            </div>
            
            <div id="uploadProgress" class="progress-bar hidden">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div id="uploadedFiles" class="file-list"></div>
        </div>

        <!-- Book Tabs -->
        <div class="tabs" id="bookTabs"></div>

        <!-- Main Content Area -->
        <div id="contentArea">
            <!-- Units View -->
            <div id="unitsView" class="card" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title" id="currentBookTitle">유닛 목록</h2>
                    <div class="flex gap-2">
                        <button class="btn btn-primary" id="addUnitBtn" onclick="addNewUnit()" style="display: none;">
                            ➕ 유닛 추가
                        </button>
                        <button class="btn btn-secondary" onclick="toggleUnitView()">
                            📊 보기 전환
                        </button>
                    </div>
                </div>
                <div class="units-grid" id="unitsGrid"></div>
            </div>

            <!-- Words View -->
            <div id="wordsView" class="card" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title" id="currentUnitTitle">단어 목록</h2>
                    <div class="flex gap-2">
                        <button class="btn btn-secondary btn-sm" onclick="backToUnits()">
                            ◀️ 뒤로
                        </button>
                        <button class="btn btn-primary" id="addWordBtn" onclick="addNewWord()" style="display: none;">
                            ➕ 단어 추가
                        </button>
                        <button class="btn btn-warning" id="batchImportBtn" onclick="batchImportWords()" style="display: none;">
                            📥 일괄 추가
                        </button>
                        <button class="btn btn-success" onclick="showExportOptions()">
                            💾 내보내기
                        </button>
                    </div>
                </div>
                
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <input type="text" class="search-input" id="searchInput" placeholder="단어 검색..." onkeyup="searchWords()">
                </div>
                
                <div id="batchActions" class="batch-actions hidden">
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                        <label for="selectAll">전체 선택</label>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="deleteSelectedWords()">
                        🗑️ 선택 삭제
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="exportSelectedWords()">
                        📤 선택 내보내기
                    </button>
                </div>
                
                <div id="wordsList"></div>
            </div>

            <!-- Study Mode View -->
            <div id="studyView" class="card" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title">🎯 학습 모드</h2>
                    <button class="btn btn-secondary" onclick="exitStudyMode()">
                        ❌ 종료
                    </button>
                </div>
                <div id="studyContent" class="text-center">
                    <p>학습할 교재와 유닛을 선택하세요.</p>
                </div>
            </div>

            <!-- Welcome Message -->
            <div id="welcomeMessage" class="card text-center">
                <h2>👋 환영합니다!</h2>
                <p class="mb-2">텍스트 파일을 업로드하여 단어장 제작을 시작하세요.</p>
                <p>파일 형식: 150_1.txt, 200_1.txt 등</p>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="wordModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('wordModal')">×</span>
            <h3 class="modal-header" id="wordModalTitle">새 단어 추가</h3>
            <form onsubmit="saveWord(event)">
                <div class="form-group">
                    <label class="form-label">영어 단어 *</label>
                    <input type="text" class="form-control" id="wordInput" required>
                </div>
                <div class="form-group">
                    <label class="form-label">품사</label>
                    <select class="form-control" id="posInput">
                        <option value="">선택안함</option>
                        <option value="명사">명사</option>
                        <option value="동사">동사</option>
                        <option value="형용사">형용사</option>
                        <option value="부사">부사</option>
                        <option value="전치사">전치사</option>
                        <option value="접속사">접속사</option>
                        <option value="대명사">대명사</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">한국어 의미 *</label>
                    <input type="text" class="form-control" id="meaningInput" required>
                </div>
                <div class="form-group">
                    <label class="form-label">예문</label>
                    <input type="text" class="form-control" id="exampleInput" placeholder="예문을 입력하세요">
                </div>
                <div class="form-group">
                    <label class="form-label">발음 (선택)</label>
                    <input type="text" class="form-control" id="pronunciationInput" placeholder="발음을 입력하세요">
                </div>
                <div class="text-right">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('wordModal')">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <div id="unitModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('unitModal')">×</span>
            <h3 class="modal-header">새 유닛 추가</h3>
            <form onsubmit="saveUnit(event)">
                <div class="form-group">
                    <label class="form-label">유닛 번호 *</label>
                    <input type="number" class="form-control" id="unitNumber" required min="1">
                </div>
                <div class="form-group">
                    <label class="form-label">유닛 제목 (영어) *</label>
                    <input type="text" class="form-control" id="unitTitleEn" required>
                </div>
                <div class="form-group">
                    <label class="form-label">유닛 제목 (한국어)</label>
                    <input type="text" class="form-control" id="unitTitleKo">
                </div>
                <div class="text-right">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('unitModal')">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <div id="batchImportModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('batchImportModal')">×</span>
            <h3 class="modal-header">단어 일괄 추가</h3>
            <p class="mb-2">한 줄에 하나씩 다음 형식으로 입력하세요:</p>
            <code style="background: #f3f4f6; padding: 10px; border-radius: 5px; display: block; margin-bottom: 20px;">
                단어 | 품사 | 의미 | 예문 | 발음<br>
                happy | 형용사 | 행복한 | I am happy. | [해피]
            </code>
            <textarea id="batchImportText" class="form-control" rows="10" placeholder="단어들을 입력하세요..."></textarea>
            <div class="text-right mt-2">
                <button type="button" class="btn btn-secondary" onclick="closeModal('batchImportModal')">취소</button>
                <button type="button" class="btn btn-primary" onclick="processBatchImport()">가져오기</button>
            </div>
        </div>
    </div>

    <div id="exportModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('exportModal')">×</span>
            <h3 class="modal-header">내보내기 옵션</h3>
            <div class="export-options">
                <div class="export-option" onclick="exportToHTML()">
                    <div class="export-icon">🌐</div>
                    <h4>HTML</h4>
                    <p>웹페이지 형식</p>
                </div>
                <div class="export-option" onclick="exportToJSON()">
                    <div class="export-icon">📄</div>
                    <h4>JSON</h4>
                    <p>데이터 백업용</p>
                </div>
                <div class="export-option" onclick="exportToCSV()">
                    <div class="export-icon">📊</div>
                    <h4>CSV</h4>
                    <p>엑셀 호환</p>
                </div>
                <div class="export-option" onclick="exportToPDF()">
                    <div class="export-icon">📑</div>
                    <h4>PDF</h4>
                    <p>인쇄용 문서</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Speech Settings Button -->
    <button class="btn btn-secondary" style="position: fixed; bottom: 20px; right: 20px; z-index: 100;" 
            onclick="toggleSpeechSettings()" title="음성 설정">
        ⚙️
    </button>
    
    <!-- Speech Settings Panel -->
    <div id="speechSettings" class="speech-settings">
        <h4 style="margin-bottom: 15px;">음성 설정</h4>
        <div class="speech-control">
            <label>속도:</label>
            <input type="range" min="0.5" max="2" step="0.1" value="0.85" id="speechRateSlider">
            <span id="speechRateValue">85%</span>
        </div>
        <div class="speech-control">
            <label>음높이:</label>
            <input type="range" min="0.5" max="2" step="0.1" value="1" id="speechPitchSlider">
            <span id="speechPitchValue">100%</span>
        </div>
        <button class="btn btn-sm btn-primary" onclick="testSpeech()">테스트</button>
        <button class="btn btn-sm btn-secondary" onclick="resetSpeechSettings()">초기화</button>
    </div>

    <script>
        // Global Data
        let vocabularyData = {};
        let currentBook = null;
        let currentUnit = null;
        let editingWord = null;
        let currentMode = 'student';
        let uploadedFilesList = [];
        let selectedWords = new Set();
        let undoStack = [];
        const MAX_UNDO_STACK = 20;
        
        // Password Management
        let MASTER_PASSWORD_HASH = null;
        let isAuthenticated = false;

        // Text-to-Speech
        let currentUtterance = null;
        let selectedVoice = null;
        let speechRate = 0.85;
        let speechPitch = 1.0;

        // Initialize on DOM load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded');
            
            // Load master password hash
            MASTER_PASSWORD_HASH = localStorage.getItem('oxfordMasterPassword') || null;
            
            // Initialize with student version check
            if (window.STUDENT_VERSION && window.STUDENT_DATA) {
                console.log('Student version detected');
                vocabularyData = window.STUDENT_DATA.vocabularyData || {};
                uploadedFilesList = window.STUDENT_DATA.uploadedFilesList || [];
                
                setupEventListeners();
                updateBookTabs();
                updateStats();
                updateUploadedFilesList();
                
                // Hide edit mode button in student version
                const editBtn = document.getElementById('editModeBtn');
                if (editBtn) editBtn.style.display = 'none';
                
                // Set to student mode
                setMode('student');
            } else {
                // Normal version
                console.log('Normal version');
                loadData();
                setupEventListeners();
                updateStats();
                updateUploadedFilesList();
                
                // Default to student mode
                setMode('student');
            }
            
            // Load speech settings
            loadSpeechSettings();
            setupSpeechControls();
        });

        // Mode Management
        function setMode(mode) {
            console.log('Setting mode:', mode);
            
            // Check authentication for edit mode
            if (mode === 'edit' && !isAuthenticated && !window.STUDENT_VERSION) {
                showAuthModal();
                return;
            }
            
            currentMode = mode;
            
            // Update button states
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const modeBtn = document.getElementById(mode + 'ModeBtn');
            if (modeBtn) modeBtn.classList.add('active');
            
            // Update UI based on mode
            const uploadCard = document.getElementById('uploadCard');
            const studentNotice = document.getElementById('studentNotice');
            const addUnitBtn = document.getElementById('addUnitBtn');
            const addWordBtn = document.getElementById('addWordBtn');
            const batchImportBtn = document.getElementById('batchImportBtn');
            const batchActions = document.getElementById('batchActions');
            
            if (mode === 'student') {
                // Student mode
                if (uploadCard) uploadCard.style.display = 'none';
                if (studentNotice) studentNotice.classList.remove('hidden');
                if (addUnitBtn) addUnitBtn.style.display = 'none';
                if (addWordBtn) addWordBtn.style.display = 'none';
                if (batchImportBtn) batchImportBtn.style.display = 'none';
                if (batchActions) batchActions.classList.add('hidden');
                
                // Hide study view
                const studyView = document.getElementById('studyView');
                if (studyView) studyView.style.display = 'none';
                
                // Add download button for student version
                addStudentDownloadButton();
                
            } else if (mode === 'edit') {
                // Edit mode
                if (uploadCard) uploadCard.style.display = 'block';
                if (studentNotice) studentNotice.classList.add('hidden');
                if (addUnitBtn) addUnitBtn.style.display = 'inline-flex';
                if (addWordBtn) addWordBtn.style.display = 'inline-flex';
                if (batchImportBtn) batchImportBtn.style.display = 'inline-flex';
                if (batchActions) batchActions.classList.remove('hidden');
                
                // Hide study view
                const studyView = document.getElementById('studyView');
                if (studyView) studyView.style.display = 'none';
                
                // Remove student download button
                removeStudentDownloadButton();
                
            } else if (mode === 'study') {
                // Study mode
                if (uploadCard) uploadCard.style.display = 'none';
                if (studentNotice) studentNotice.classList.add('hidden');
                
                showStudyMode();
                
                // Remove student download button
                removeStudentDownloadButton();
            }
            
            // Update book tabs to show/hide delete buttons
            updateBookTabs();
            
            // Refresh current view
            if (currentBook && mode !== 'study') {
                if (currentUnit) {
                    showWords(currentUnit);
                } else {
                    showUnits();
                }
            }
        }

        // Password Management Functions
        async function hashPassword(password) {
            try {
                const encoder = new TextEncoder();
                const data = encoder.encode(password);
                const hash = await crypto.subtle.digest('SHA-256', data);
                return Array.from(new Uint8Array(hash))
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');
            } catch (error) {
                console.error('암호 해시 오류:', error);
                // Fallback hash
                let hash = 0;
                for (let i = 0; i < password.length; i++) {
                    const char = password.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash).toString(16);
            }
        }

        async function checkPassword(password) {
            if (!password) return false;
            const hash = await hashPassword(password);
            return hash === MASTER_PASSWORD_HASH;
        }

        async function setMasterPassword(password) {
            const hash = await hashPassword(password);
            localStorage.setItem('oxfordMasterPassword', hash);
            MASTER_PASSWORD_HASH = hash;
            showToast('원장님 암호가 설정되었습니다.');
        }

        function showAuthModal() {
            closeAllModals();
            
            let modal = document.getElementById('authModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'authModal';
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 400px;">
                        <h3 class="modal-header">🔐 원장님 모드 인증</h3>
                        <form id="authForm" onsubmit="authenticateUser(event)">
                            <div class="form-group">
                                <label class="form-label">암호를 입력하세요</label>
                                <input type="password" class="form-control" id="authPassword" required autofocus>
                            </div>
                            <div class="text-right">
                                <button type="button" class="btn btn-secondary" onclick="cancelAuth()">취소</button>
                                <button type="submit" class="btn btn-primary">확인</button>
                            </div>
                        </form>
                        ${!MASTER_PASSWORD_HASH ? `
                        <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 8px;">
                            <p style="margin: 0; font-size: 14px;">⚠️ 첫 사용자입니다. 원장님 암호를 설정해주세요.</p>
                        </div>
                        ` : ''}
                    </div>
                `;
                document.body.appendChild(modal);
            }
            
            modal.style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('authPassword')?.focus();
            }, 100);
        }

        async function authenticateUser(event) {
            event.preventDefault();
            const password = document.getElementById('authPassword').value;
            
            if (!MASTER_PASSWORD_HASH) {
                // First user - set password
                await setMasterPassword(password);
                isAuthenticated = true;
                closeModal('authModal');
                setMode('edit');
            } else {
                // Existing user - check password
                if (await checkPassword(password)) {
                    isAuthenticated = true;
                    closeModal('authModal');
                    setMode('edit');
                    showToast('원장님 모드로 전환되었습니다.');
                } else {
                    showToast('암호가 일치하지 않습니다.', true);
                    document.getElementById('authPassword').value = '';
                }
            }
        }

        function cancelAuth() {
            closeModal('authModal');
            setMode('student');
        }

        // Student Download Button Management
        function addStudentDownloadButton() {
            if (!document.getElementById('studentDownloadBtn')) {
                const btn = document.createElement('button');
                btn.id = 'studentDownloadBtn';
                btn.className = 'btn btn-success';
                btn.innerHTML = '📥 학생용 파일 다운로드';
                btn.onclick = downloadStudentVersion;
                
                const modeSwitcher = document.querySelector('.mode-switcher');
                if (modeSwitcher) {
                    modeSwitcher.appendChild(btn);
                }
            }
        }

        function removeStudentDownloadButton() {
            const btn = document.getElementById('studentDownloadBtn');
            if (btn) btn.remove();
        }

        function downloadStudentVersion() {
            if (!isAuthenticated && MASTER_PASSWORD_HASH) {
                showToast('원장님 인증이 필요합니다.', true);
                return;
            }
            
            showLoading();
            
            try {
                let studentHTML = document.documentElement.outerHTML;
                
                const dataScript = `
        // Student version flag
        window.STUDENT_VERSION = true;
        window.STUDENT_DATA = ${JSON.stringify({
            vocabularyData: vocabularyData,
            uploadedFilesList: uploadedFilesList
        })};
        `;
                
                const scriptIndex = studentHTML.indexOf('<script>');
                studentHTML = studentHTML.substring(0, scriptIndex + 8) + 
                            '\n' + dataScript + '\n' + 
                            studentHTML.substring(scriptIndex + 8);
                
                const date = new Date().toISOString().split('T')[0];
                const filename = `oxford_vocabulary_student_${date}.html`;
                
                const blob = new Blob([studentHTML], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                hideLoading();
                showToast('학생용 파일이 생성되었습니다!');
                
            } catch (error) {
                console.error('Student file creation error:', error);
                hideLoading();
                showToast('파일 생성 중 오류가 발생했습니다.', true);
            }
        }

        // Data Management
        function loadData() {
            try {
                const savedData = localStorage.getItem('oxfordVocabularyData');
                if (savedData) {
                    vocabularyData = JSON.parse(savedData);
                }
                
                const savedFiles = localStorage.getItem('oxfordUploadedFiles');
                if (savedFiles) {
                    uploadedFilesList = JSON.parse(savedFiles);
                }
                
                updateBookTabs();
            } catch (error) {
                console.error('데이터 로드 오류:', error);
                vocabularyData = {};
                uploadedFilesList = [];
            }
        }

        function saveData() {
            try {
                localStorage.setItem('oxfordVocabularyData', JSON.stringify(vocabularyData));
                localStorage.setItem('oxfordUploadedFiles', JSON.stringify(uploadedFilesList));
            } catch (error) {
                console.error('데이터 저장 오류:', error);
                showToast('데이터 저장 중 오류가 발생했습니다.', true);
            }
        }

        function saveToUndoStack() {
            const state = {
                vocabularyData: JSON.parse(JSON.stringify(vocabularyData)),
                timestamp: Date.now()
            };
            
            undoStack.push(state);
            
            if (undoStack.length > MAX_UNDO_STACK) {
                undoStack.shift();
            }
        }

        function undo() {
            if (undoStack.length === 0) {
                showToast('되돌릴 작업이 없습니다.', true);
                return;
            }
            
            const state = undoStack.pop();
            vocabularyData = state.vocabularyData;
            saveData();
            updateBookTabs();
            
            if (currentBook) {
                if (currentUnit) {
                    showWords(currentUnit);
                } else {
                    showUnits();
                }
            }
            
            showToast('작업을 되돌렸습니다.');
        }

        function clearAllData() {
            if (currentMode !== 'edit') {
                showToast('원장님 모드에서만 데이터를 초기화할 수 있습니다.', true);
                return;
            }
            
            if (confirm('정말로 모든 데이터를 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다.')) {
                if (confirm('마지막 확인: 모든 데이터가 삭제됩니다. 계속하시겠습니까?')) {
                    vocabularyData = {};
                    uploadedFilesList = [];
                    currentBook = null;
                    currentUnit = null;
                    selectedWords.clear();
                    undoStack = [];
                    
                    saveData();
                    updateBookTabs();
                    updateStats();
                    updateUploadedFilesList();
                    
                    document.getElementById('welcomeMessage').style.display = 'block';
                    document.getElementById('unitsView').style.display = 'none';
                    document.getElementById('wordsView').style.display = 'none';
                    
                    showToast('모든 데이터가 초기화되었습니다.');
                }
            }
        }

        // Event Listeners Setup
        function setupEventListeners() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            if (uploadArea && fileInput) {
                uploadArea.addEventListener('click', () => fileInput.click());
                
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('drag-over');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('drag-over');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('drag-over');
                    handleFiles(e.dataTransfer.files);
                });

                fileInput.addEventListener('change', (e) => {
                    handleFiles(e.target.files);
                });
            }

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'z':
                            e.preventDefault();
                            undo();
                            break;
                        case 's':
                            e.preventDefault();
                            saveData();
                            showToast('데이터가 저장되었습니다.');
                            break;
                    }
                }
            });
        }

        // File Handling
        async function handleFiles(files) {
            if (!files || files.length === 0) return;
            
            const progressBar = document.getElementById('uploadProgress');
            const progressFill = document.getElementById('progressFill');
            
            if (progressBar) progressBar.classList.remove('hidden');
            
            const sortedFiles = Array.from(files).sort((a, b) => {
                return a.name.localeCompare(b.name, 'ko', { numeric: true });
            });

            let processedCount = 0;
            
            for (const file of sortedFiles) {
                try {
                    if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                        const content = await readFileAsync(file);
                        parseFile(file.name, content);
                        
                        if (!uploadedFilesList.find(f => f.name === file.name)) {
                            uploadedFilesList.push({
                                name: file.name,
                                uploadTime: new Date().toLocaleString('ko-KR')
                            });
                        }
                    } else if (file.name.endsWith('.json')) {
                        const content = await readFileAsync(file);
                        importJSONData(content);
                    } else {
                        showToast(`${file.name}은(는) 지원하지 않는 파일 형식입니다.`, true);
                    }
                    
                    processedCount++;
                    const progress = (processedCount / sortedFiles.length) * 100;
                    if (progressFill) progressFill.style.width = progress + '%';
                    
                } catch (error) {
                    console.error(`파일 처리 오류 (${file.name}):`, error);
                    showToast(`${file.name} 파일 처리 중 오류가 발생했습니다.`, true);
                }
            }
            
            setTimeout(() => {
                if (progressBar) progressBar.classList.add('hidden');
                if (progressFill) progressFill.style.width = '0%';
            }, 1000);
            
            updateUploadedFilesList();
            saveData();
        }

        function readFileAsync(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        function parseFile(filename, content) {
            try {
                const bookCode = filename.replace('.txt', '').replace('_', '-');
                
                if (!vocabularyData[bookCode]) {
                    vocabularyData[bookCode] = {
                        name: `Oxford ${bookCode}`,
                        units: {}
                    };
                }

                const lines = content.split(/\r?\n/);
                let currentUnitNum = null;
                let currentWord = null;
                
                lines.forEach((line, lineIndex) => {
                    line = line.trim();
                    if (!line) {
                        if (currentWord && currentWord.word && currentWord.meaning && currentUnitNum) {
                            if (!vocabularyData[bookCode].units[currentUnitNum]) {
                                vocabularyData[bookCode].units[currentUnitNum] = {
                                    title: `Unit ${currentUnitNum}`,
                                    words: []
                                };
                            }
                            vocabularyData[bookCode].units[currentUnitNum].words.push(currentWord);
                            currentWord = null;
                        }
                        return;
                    }

                    // Unit detection
                    const unitMatch = line.match(/^unit\s*(\d+)[:\s]*(.*)/i);
                    if (unitMatch) {
                        if (currentWord && currentWord.word && currentWord.meaning && currentUnitNum) {
                            if (!vocabularyData[bookCode].units[currentUnitNum]) {
                                vocabularyData[bookCode].units[currentUnitNum] = {
                                    title: `Unit ${currentUnitNum}`,
                                    words: []
                                };
                            }
                            vocabularyData[bookCode].units[currentUnitNum].words.push(currentWord);
                        }
                        
                        currentUnitNum = parseInt(unitMatch[1]);
                        const unitTitle = unitMatch[2].trim() || `Unit ${currentUnitNum}`;
                        
                        if (!vocabularyData[bookCode].units[currentUnitNum]) {
                            vocabularyData[bookCode].units[currentUnitNum] = {
                                title: unitTitle,
                                words: []
                            };
                        }
                        
                        currentWord = null;
                        return;
                    }

                    if (!currentUnitNum) return;

                    // 200_1.txt format: word (meaning)
                    const wordWithMeaningMatch = line.match(/^([a-zA-Z][a-zA-Z\s]+?)\s*\(([^)]+)\)$/);
                    if (wordWithMeaningMatch) {
                        if (currentWord && currentWord.word && currentWord.meaning) {
                            vocabularyData[bookCode].units[currentUnitNum].words.push(currentWord);
                        }
                        
                        currentWord = {
                            word: wordWithMeaningMatch[1].trim(),
                            pos: '',
                            meaning: wordWithMeaningMatch[2].trim(),
                            example: '',
                            pronunciation: ''
                        };
                        return;
                    }

                    // Arrow lines (POS info)
                    if (currentWord && line.startsWith('→')) {
                        const arrowContent = line.substring(1).trim();
                        const posMatch = arrowContent.match(/^(명사|동사|형용사|부사|전치사|접속사|대명사):\s*(.*)$/);
                        if (posMatch) {
                            currentWord.pos = posMatch[1];
                            if (!currentWord.meaning || currentWord.meaning === posMatch[1]) {
                                currentWord.meaning = posMatch[2] || currentWord.meaning;
                            }
                        }
                        return;
                    }

                    // Example
                    if (currentWord && line.startsWith('예:')) {
                        currentWord.example = line.substring(2).trim();
                        return;
                    }

                    // English word only
                    if (line.match(/^[a-zA-Z][a-zA-Z\s]*$/) && !line.includes('Unit')) {
                        if (currentWord && currentWord.word && currentWord.meaning) {
                            vocabularyData[bookCode].units[currentUnitNum].words.push(currentWord);
                        }
                        
                        currentWord = {
                            word: line.trim(),
                            pos: '',
                            meaning: '',
                            example: '',
                            pronunciation: ''
                        };
                        return;
                    }

                    // [POS] meaning format
                    if (currentWord && line.includes('[') && line.includes(']')) {
                        const match = line.match(/\[(.*?)\]\s*(.*)/);
                        if (match) {
                            currentWord.pos = match[1];
                            currentWord.meaning = match[2];
                        }
                        return;
                    }

                    // Pronunciation
                    if (currentWord && line.startsWith('발음:')) {
                        currentWord.pronunciation = line.substring(3).trim();
                        return;
                    }
                    
                    // Korean only (meaning)
                    if (currentWord && !currentWord.meaning && line.match(/^[가-힣\s,]+$/)) {
                        currentWord.meaning = line.trim();
                        return;
                    }
                });

                // Save last word
                if (currentWord && currentUnitNum && currentWord.word && currentWord.meaning) {
                    if (!vocabularyData[bookCode].units[currentUnitNum]) {
                        vocabularyData[bookCode].units[currentUnitNum] = {
                            title: `Unit ${currentUnitNum}`,
                            words: []
                        };
                    }
                    vocabularyData[bookCode].units[currentUnitNum].words.push(currentWord);
                }

                saveData();
                updateBookTabs();
                
                let totalWords = 0;
                let unitList = [];
                Object.entries(vocabularyData[bookCode].units).forEach(([unitNum, unit]) => {
                    totalWords += unit.words.length;
                    unitList.push(`Unit ${unitNum}: ${unit.words.length}개`);
                });
                
                console.log(`${filename} 파싱 완료:`, unitList.join(', '));
                showToast(`${filename} 파일을 성공적으로 불러왔습니다! (${Object.keys(vocabularyData[bookCode].units).length}개 유닛, ${totalWords}개 단어)`);
                
            } catch (error) {
                console.error('파일 파싱 오류:', error);
                showToast(`${filename} 파일 파싱 중 오류가 발생했습니다.`, true);
            }
        }

        function importJSONData(jsonString) {
            try {
                const data = JSON.parse(jsonString);
                
                if (data.vocabularyData) {
                    vocabularyData = { ...vocabularyData, ...data.vocabularyData };
                    if (data.uploadedFiles) {
                        uploadedFilesList = [...uploadedFilesList, ...data.uploadedFiles];
                    }
                } else {
                    vocabularyData = { ...vocabularyData, ...data };
                }
                
                saveData();
                updateBookTabs();
                updateUploadedFilesList();
                showToast('데이터를 성공적으로 가져왔습니다!');
            } catch (error) {
                console.error('JSON 가져오기 오류:', error);
                showToast('JSON 파일 형식이 올바르지 않습니다.', true);
            }
        }

        function updateUploadedFilesList() {
            const uploadedFiles = document.getElementById('uploadedFiles');
            if (!uploadedFiles) return;
            
            const sortedFilesList = [...uploadedFilesList].sort((a, b) => {
                return a.name.localeCompare(b.name, 'ko', { numeric: true });
            });
            
            uploadedFiles.innerHTML = sortedFilesList.map(file => `
                <div class="file-item">
                    <span class="file-name">📄 ${file.name}</span>
                    <span class="file-status">✅ ${file.uploadTime}</span>
                </div>
            `).join('');
        }

        function showSampleFormat() {
            const sampleText = `Unit 1: Greetings
hello
[명사] 안녕, 인사
예: Hello, how are you?
발음: [헬로우]

world
[명사] 세계, 세상
예: The world is beautiful.
발음: [월드]

Unit 2: Numbers
one
[명사] 하나, 1
예: I have one apple.
발음: [원]`;

            alert('파일 형식 예시:\n\n' + sampleText);
        }

        // UI Updates
        function updateStats() {
            let totalBooks = Object.keys(vocabularyData).length;
            let totalUnits = 0;
            let totalWords = 0;
            
            Object.values(vocabularyData).forEach(book => {
                const unitCount = Object.keys(book.units || {}).length;
                totalUnits += unitCount;
                
                Object.values(book.units || {}).forEach(unit => {
                    totalWords += (unit.words || []).length;
                });
            });
            
            const avgWords = totalUnits > 0 ? Math.round(totalWords / totalUnits) : 0;
            
            document.getElementById('totalBooks').textContent = totalBooks;
            document.getElementById('totalUnits').textContent = totalUnits;
            document.getElementById('totalWords').textContent = totalWords;
            document.getElementById('avgWords').textContent = avgWords;
        }

        function updateBookTabs() {
            const tabs = document.getElementById('bookTabs');
            if (!tabs) return;
            
            tabs.innerHTML = '';
            
            const bookCodes = Object.keys(vocabularyData).sort((a, b) => {
                return a.localeCompare(b, 'ko', { numeric: true });
            });
            
            bookCodes.forEach(bookCode => {
                const tabWrapper = document.createElement('div');
                tabWrapper.style.display = 'inline-block';
                tabWrapper.style.position = 'relative';
                
                const tab = document.createElement('button');
                tab.className = `tab ${currentBook === bookCode ? 'active' : ''}`;
                tab.textContent = bookCode;
                tab.onclick = () => selectBook(bookCode);
                
                tabWrapper.appendChild(tab);
                
                // Delete button (only in edit mode)
                if (currentMode === 'edit') {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn-book-delete';
                    deleteBtn.innerHTML = '×';
                    deleteBtn.title = '교재 삭제';
                    deleteBtn.onclick = (e) => {
                        e.stopPropagation();
                        deleteBook(bookCode);
                    };
                    tabWrapper.appendChild(deleteBtn);
                }
                
                tabs.appendChild(tabWrapper);
            });

            if (!currentBook && bookCodes.length > 0) {
                selectBook(bookCodes[0]);
            }
        }

        function selectBook(bookCode) {
            currentBook = bookCode;
            currentUnit = null;
            updateBookTabs();
            showUnits();
        }

        function deleteBook(bookCode) {
            if (currentMode !== 'edit') {
                showToast('원장님 모드에서만 삭제할 수 있습니다.', true);
                return;
            }
            
            if (confirm(`정말로 ${bookCode} 교재를 삭제하시겠습니까?`)) {
                saveToUndoStack();
                delete vocabularyData[bookCode];
                
                if (currentBook === bookCode) {
                    currentBook = null;
                    currentUnit = null;
                    
                    const remainingBooks = Object.keys(vocabularyData);
                    if (remainingBooks.length > 0) {
                        selectBook(remainingBooks[0]);
                    } else {
                        document.getElementById('welcomeMessage').style.display = 'block';
                        document.getElementById('unitsView').style.display = 'none';
                        document.getElementById('wordsView').style.display = 'none';
                    }
                }
                
                saveData();
                updateBookTabs();
                updateStats();
                showToast('교재가 삭제되었습니다.');
            }
        }

        function showUnits() {
            const welcomeMsg = document.getElementById('welcomeMessage');
            const unitsView = document.getElementById('unitsView');
            const wordsView = document.getElementById('wordsView');
            const studyView = document.getElementById('studyView');
            
            if (welcomeMsg) welcomeMsg.style.display = 'none';
            if (unitsView) unitsView.style.display = 'block';
            if (wordsView) wordsView.style.display = 'none';
            if (studyView) studyView.style.display = 'none';
            
            if (!currentBook || !vocabularyData[currentBook]) {
                return;
            }
            
            const book = vocabularyData[currentBook];
            const bookTitle = document.getElementById('currentBookTitle');
            if (bookTitle) bookTitle.textContent = book.name;
            
            const grid = document.getElementById('unitsGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            const unitKeys = Object.keys(book.units || {});
            if (unitKeys.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">유닛이 없습니다. 유닛을 추가해주세요.</p>';
                return;
            }
            
            unitKeys.sort((a, b) => parseInt(a) - parseInt(b)).forEach(unitNum => {
                const unit = book.units[unitNum];
                const card = document.createElement('div');
                card.className = 'unit-card';
                card.onclick = () => showWords(unitNum);
                card.innerHTML = `
                    <div class="unit-count">${unit.words.length} 단어</div>
                    <div class="unit-title">Unit ${unitNum}</div>
                    <div class="unit-subtitle">${unit.title}</div>
                    ${currentMode === 'edit' ? `
                    <button class="btn btn-danger btn-sm" style="position: absolute; bottom: 10px; right: 10px;" 
                            onclick="deleteUnit(event, '${unitNum}')">
                        🗑️
                    </button>
                    ` : ''}
                `;
                grid.appendChild(card);
            });
            
            updateStats();
        }

        function showWords(unitNum) {
            if (!currentBook || !vocabularyData[currentBook] || !vocabularyData[currentBook].units[unitNum]) {
                showToast('유닛을 찾을 수 없습니다.', true);
                return;
            }
            
            currentUnit = unitNum;
            const unitsView = document.getElementById('unitsView');
            const wordsView = document.getElementById('wordsView');
            
            if (unitsView) unitsView.style.display = 'none';
            if (wordsView) wordsView.style.display = 'block';
            
            const unit = vocabularyData[currentBook].units[unitNum];
            const unitTitle = document.getElementById('currentUnitTitle');
            if (unitTitle) unitTitle.textContent = `Unit ${unitNum}: ${unit.title}`;
            
            displayWords();
        }

        function displayWords() {
            const wordsList = document.getElementById('wordsList');
            if (!wordsList || !currentBook || !currentUnit) return;
            
            const unit = vocabularyData[currentBook]?.units?.[currentUnit];
            if (!unit || !unit.words) {
                wordsList.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">단어가 없습니다.</p>';
                return;
            }
            
            if (unit.words.length === 0) {
                wordsList.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">단어가 없습니다. 단어를 추가해주세요.</p>';
                return;
            }
            
            wordsList.innerHTML = '';
            
            unit.words.forEach((word, index) => {
                const div = createWordCard(word, index);
                wordsList.appendChild(div);
            });
        }

        function createWordCard(word, index) {
            const div = document.createElement('div');
            div.className = 'word-card';
            
            const safeWord = (word.word || '').replace(/'/g, "\\'");
            const safeExample = (word.example || '').replace(/'/g, "\\'");
            
            div.innerHTML = `
                <div class="word-header">
                    <div>
                        ${currentMode === 'edit' ? `
                        <input type="checkbox" class="word-checkbox" data-index="${index}" 
                               onchange="toggleWordSelection(${index})">
                        ` : ''}
                        <span class="word-title">${word.word || ''}</span>
                        ${word.pos ? `<span class="word-pos">${word.pos}</span>` : ''}
                        ${word.pronunciation ? `<span style="color: #9ca3af; margin-left: 10px;">${word.pronunciation}</span>` : ''}
                    </div>
                    ${currentMode === 'edit' ? `
                    <div class="flex gap-2">
                        <button class="btn btn-sm btn-primary" onclick="editWord(${index})">✏️</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteWord(${index})">🗑️</button>
                    </div>
                    ` : ''}
                </div>
                <div class="word-meaning">${word.meaning || ''}</div>
                ${word.example ? `<div class="word-example">${word.example}</div>` : ''}
                <div class="audio-controls">
                    <button class="audio-btn" onclick="speakWord('${safeWord}', this)">🔊 발음 듣기</button>
                    ${word.example ? `<button class="audio-btn" onclick="speakSentence('${safeExample}', this)">📢 예문 듣기</button>` : ''}
                </div>
            `;
            
            return div;
        }

        function backToUnits() {
            showUnits();
            selectedWords.clear();
            const selectAll = document.getElementById('selectAll');
            if (selectAll) selectAll.checked = false;
        }

        function toggleUnitView() {
            showToast('보기 전환 기능은 준비 중입니다.');
        }

        // Unit Management
        function addNewUnit() {
            if (currentMode !== 'edit') {
                showToast('원장님 모드에서만 유닛을 추가할 수 있습니다.', true);
                return;
            }
            
            document.getElementById('unitNumber').value = '';
            document.getElementById('unitTitleEn').value = '';
            document.getElementById('unitTitleKo').value = '';
            
            document.getElementById('unitModal').style.display = 'block';
        }

        function saveUnit(event) {
            event.preventDefault();
            
            saveToUndoStack();
            
            const unitNum = document.getElementById('unitNumber').value;
            const titleEn = document.getElementById('unitTitleEn').value;
            const titleKo = document.getElementById('unitTitleKo').value;
            
            if (!vocabularyData[currentBook].units) {
                vocabularyData[currentBook].units = {};
            }
            
            vocabularyData[currentBook].units[unitNum] = {
                title: titleKo ? `${titleEn} (${titleKo})` : titleEn,
                words: []
            };
            
            saveData();
            showUnits();
            closeModal('unitModal');
            showToast('유닛이 추가되었습니다!');
        }

        function deleteUnit(event, unitNum) {
            event.stopPropagation();
            
            if (currentMode !== 'edit') {
                showToast('원장님 모드에서만 유닛을 삭제할 수 있습니다.', true);
                return;
            }
            
            const wordCount = vocabularyData[currentBook].units[unitNum].words.length;
            if (confirm(`Unit ${unitNum}을(를) 삭제하시겠습니까?\n${wordCount}개의 단어가 함께 삭제됩니다.`)) {
                saveToUndoStack();
                delete vocabularyData[currentBook].units[unitNum];
                saveData();
                showUnits();
                showToast('유닛이 삭제되었습니다.');
            }
        }

        // Word Management
        function addNewWord() {
            if (currentMode !== 'edit') {
                showToast('원장님 모드에서만 단어를 추가할 수 있습니다.', true);
                return;
            }
            
            editingWord = null;
            document.getElementById('wordModalTitle').textContent = '새 단어 추가';
            document.getElementById('wordInput').value = '';
            document.getElementById('posInput').value = '';
            document.getElementById('meaningInput').value = '';
            document.getElementById('exampleInput').value = '';
            document.getElementById('pronunciationInput').value = '';
            document.getElementById('wordModal').style.display = 'block';
        }

        function editWord(index) {
            if (currentMode !== 'edit') {
                showToast('원장님 모드에서만 단어를 수정할 수 있습니다.', true);
                return;
            }
            
            editingWord = index;
            const word = vocabularyData[currentBook].units[currentUnit].words[index];
            document.getElementById('wordModalTitle').textContent = '단어 수정';
            document.getElementById('wordInput').value = word.word;
            document.getElementById('posInput').value = word.pos || '';
            document.getElementById('meaningInput').value = word.meaning;
            document.getElementById('exampleInput').value = word.example || '';
            document.getElementById('pronunciationInput').value = word.pronunciation || '';
            document.getElementById('wordModal').style.display = 'block';
        }

        function saveWord(event) {
            event.preventDefault();
            
            saveToUndoStack();
            
            const wordData = {
                word: document.getElementById('wordInput').value.trim(),
                pos: document.getElementById('posInput').value,
                meaning: document.getElementById('meaningInput').value.trim(),
                example: document.getElementById('exampleInput').value.trim(),
                pronunciation: document.getElementById('pronunciationInput').value.trim()
            };

            if (editingWord !== null) {
                vocabularyData[currentBook].units[currentUnit].words[editingWord] = wordData;
            } else {
                vocabularyData[currentBook].units[currentUnit].words.push(wordData);
            }

            saveData();
            displayWords();
            updateStats();
            closeModal('wordModal');
            showToast(editingWord !== null ? '단어가 수정되었습니다!' : '단어가 추가되었습니다!');
        }

        function deleteWord(index) {
            if (currentMode !== 'edit') {
                showToast('원장님 모드에서만 단어를 삭제할 수 있습니다.', true);
                return;
            }
            
            if (confirm('정말로 이 단어를 삭제하시겠습니까?')) {
                saveToUndoStack();
                vocabularyData[currentBook].units[currentUnit].words.splice(index, 1);
                saveData();
                displayWords();
                updateStats();
                showToast('단어가 삭제되었습니다.');
            }
        }

        function searchWords() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.word-card');
            
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        function batchImportWords() {
            if (currentMode !== 'edit') {
                showToast('원장님 모드에서만 일괄 추가할 수 있습니다.', true);
                return;
            }
            
            document.getElementById('batchImportText').value = '';
            document.getElementById('batchImportModal').style.display = 'block';
        }

        function processBatchImport() {
            const text = document.getElementById('batchImportText').value.trim();
            if (!text) {
                showToast('입력된 내용이 없습니다.', true);
                return;
            }
            
            saveToUndoStack();
            
            const lines = text.split('\n');
            let importCount = 0;
            
            lines.forEach(line => {
                const parts = line.split('|').map(p => p.trim());
                if (parts[0] && parts[2]) { // At least word and meaning required
                    vocabularyData[currentBook].units[currentUnit].words.push({
                        word: parts[0],
                        pos: parts[1] || '',
                        meaning: parts[2],
                        example: parts[3] || '',
                        pronunciation: parts[4] || ''
                    });
                    importCount++;
                }
            });
            
            if (importCount === 0) {
                showToast('올바른 형식의 단어가 없습니다.', true);
                return;
            }
            
            saveData();
            displayWords();
            updateStats();
            closeModal('batchImportModal');
            showToast(`${importCount}개의 단어가 추가되었습니다!`);
        }

        function toggleWordSelection(index) {
            if (selectedWords.has(index)) {
                selectedWords.delete(index);
            } else {
                selectedWords.add(index);
            }
        }

        function toggleSelectAll() {
            const isChecked = document.getElementById('selectAll').checked;
            const checkboxes = document.querySelectorAll('.word-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
                const index = parseInt(checkbox.dataset.index);
                if (isChecked) {
                    selectedWords.add(index);
                } else {
                    selectedWords.delete(index);
                }
            });
        }

        function deleteSelectedWords() {
            if (selectedWords.size === 0) {
                showToast('선택된 단어가 없습니다.', true);
                return;
            }
            
            if (confirm(`${selectedWords.size}개의 단어를 삭제하시겠습니까?`)) {
                saveToUndoStack();
                
                const indices = Array.from(selectedWords).sort((a, b) => b - a);
                indices.forEach(index => {
                    vocabularyData[currentBook].units[currentUnit].words.splice(index, 1);
                });
                
                selectedWords.clear();
                saveData();
                displayWords();
                updateStats();
                showToast('선택한 단어들이 삭제되었습니다.');
            }
        }

        function exportSelectedWords() {
            if (selectedWords.size === 0) {
                showToast('선택된 단어가 없습니다.', true);
                return;
            }
            
            const selectedWordsList = Array.from(selectedWords)
                .sort((a, b) => a - b)
                .map(index => vocabularyData[currentBook].units[currentUnit].words[index]);
            
            const data = {
                book: currentBook,
                unit: currentUnit,
                words: selectedWordsList
            };
            
            const json = JSON.stringify(data, null, 2);
            downloadFile(`${currentBook}_unit${currentUnit}_selected.json`, json, 'application/json');
            showToast(`${selectedWords.size}개의 선택된 단어를 내보냈습니다!`);
        }

        // Export Functions
        function showExportOptions() {
            document.getElementById('exportModal').style.display = 'block';
        }

        function exportToHTML() {
            const book = vocabularyData[currentBook];
            const unit = book.units[currentUnit];
            
            const html = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${book.name} - Unit ${currentUnit}</title>
    <style>
        body {
            font-family: -apple-system, 'Noto Sans KR', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #6366f1, #ec4899);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }
        .word-card {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .word {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6366f1;
        }
        .pos {
            background: #e0e7ff;
            color: #6366f1;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        .meaning {
            font-size: 1.1rem;
            margin: 10px 0;
        }
        .example {
            font-style: italic;
            color: #666;
            background: #f9fafb;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .pronunciation {
            color: #9ca3af;
            font-size: 0.9rem;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>${book.name}</h1>
        <h2>Unit ${currentUnit}: ${unit.title}</h2>
    </div>
    ${unit.words.map(word => `
    <div class="word-card">
        <div>
            <span class="word">${word.word}</span>
            ${word.pos ? `<span class="pos">${word.pos}</span>` : ''}
            ${word.pronunciation ? `<span class="pronunciation">${word.pronunciation}</span>` : ''}
        </div>
        <div class="meaning">${word.meaning}</div>
        ${word.example ? `<div class="example">${word.example}</div>` : ''}
    </div>
    `).join('')}
</body>
</html>`;

            downloadFile(`${currentBook}_unit${currentUnit}.html`, html, 'text/html');
            closeModal('exportModal');
            showToast('HTML 파일이 저장되었습니다!');
        }

        function exportToJSON() {
            const data = currentUnit ? 
                { [currentBook]: { units: { [currentUnit]: vocabularyData[currentBook].units[currentUnit] } } } :
                vocabularyData;
            
            const json = JSON.stringify(data, null, 2);
            const filename = currentUnit ? `${currentBook}_unit${currentUnit}.json` : 'oxford_vocabulary_backup.json';
            
            downloadFile(filename, json, 'application/json');
            closeModal('exportModal');
            showToast('JSON 파일이 저장되었습니다!');
        }

        function exportToCSV() {
            try {
                const unit = vocabularyData[currentBook]?.units?.[currentUnit];
                if (!unit || !unit.words || unit.words.length === 0) {
                    showToast('내보낼 단어가 없습니다.', true);
                    return;
                }
                
                let csv = '\uFEFF'; // BOM for Excel UTF-8
                csv += '단어,품사,의미,예문,발음\n';
                
                unit.words.forEach(word => {
                    const escapeCSV = (str) => {
                        if (!str) return '';
                        if (str.includes(',') || str.includes('\n') || str.includes('"')) {
                            return '"' + str.replace(/"/g, '""') + '"';
                        }
                        return str;
                    };
                    
                    csv += `${escapeCSV(word.word)},${escapeCSV(word.pos || '')},${escapeCSV(word.meaning)},${escapeCSV(word.example || '')},${escapeCSV(word.pronunciation || '')}\n`;
                });
                
                downloadFile(`${currentBook}_unit${currentUnit}.csv`, csv, 'text/csv');
                closeModal('exportModal');
                showToast('CSV 파일이 저장되었습니다!');
            } catch (error) {
                console.error('CSV export error:', error);
                showToast('CSV 내보내기 중 오류가 발생했습니다.', true);
            }
        }

        function exportToPDF() {
            const book = vocabularyData[currentBook];
            const unit = book.units[currentUnit];
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <title>${book.name} - Unit ${currentUnit}</title>
                    <style>
                        @media print {
                            body { margin: 0; }
                            .word-card { page-break-inside: avoid; }
                        }
                        body {
                            font-family: 'Noto Sans KR', sans-serif;
                            max-width: 210mm;
                            margin: 0 auto;
                            padding: 20mm;
                        }
                        h1, h2 { text-align: center; }
                        .word-card {
                            margin-bottom: 15px;
                            padding: 10px;
                            border: 1px solid #ddd;
                        }
                        .word { font-weight: bold; font-size: 16pt; }
                        .pos { color: #666; }
                        .meaning { margin: 5px 0; }
                        .example { font-style: italic; color: #666; }
                    </style>
                </head>
                <body>
                    <h1>${book.name}</h1>
                    <h2>Unit ${currentUnit}: ${unit.title}</h2>
                    ${unit.words.map(word => `
                    <div class="word-card">
                        <div class="word">${word.word} ${word.pos ? `[${word.pos}]` : ''}</div>
                        <div class="meaning">${word.meaning}</div>
                        ${word.example ? `<div class="example">예: ${word.example}</div>` : ''}
                    </div>
                    `).join('')}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
            
            closeModal('exportModal');
            showToast('인쇄 창이 열렸습니다. PDF로 저장하려면 프린터를 PDF로 선택하세요.');
        }

        function exportAllData() {
            const json = JSON.stringify({
                vocabularyData: vocabularyData,
                uploadedFiles: uploadedFilesList,
                exportDate: new Date().toISOString()
            }, null, 2);
            
            downloadFile('oxford_vocabulary_complete_backup.json', json, 'application/json');
            showToast('전체 백업이 완료되었습니다!');
        }

        function downloadFile(filename, content, type) {
            const blob = new Blob([content], { type: type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Study Mode
        function showStudyMode() {
            const welcomeMsg = document.getElementById('welcomeMessage');
            const unitsView = document.getElementById('unitsView');
            const wordsView = document.getElementById('wordsView');
            const studyView = document.getElementById('studyView');
            
            if (welcomeMsg) welcomeMsg.style.display = 'none';
            if (unitsView) unitsView.style.display = 'none';
            if (wordsView) wordsView.style.display = 'none';
            if (studyView) studyView.style.display = 'block';
            
            const studyContent = document.getElementById('studyContent');
            if (!studyContent) return;
            
            if (Object.keys(vocabularyData).length === 0) {
                studyContent.innerHTML = `
                    <p>학습할 교재가 없습니다. 먼저 교재를 업로드해주세요.</p>
                    <button class="btn btn-primary" onclick="setMode('edit')">원장님 모드로 이동</button>
                `;
                return;
            }
            
            if (!currentBook || !vocabularyData[currentBook]) {
                const bookOptions = Object.keys(vocabularyData)
                    .sort((a, b) => a.localeCompare(b, 'ko', { numeric: true }))
                    .map(bookCode => `
                        <option value="${bookCode}">${vocabularyData[bookCode].name}</option>
                    `).join('');
                
                studyContent.innerHTML = `
                    <div class="form-group">
                        <label class="form-label">학습할 교재 선택</label>
                        <select class="form-control" id="studyBookSelect" onchange="selectStudyBook()">
                            <option value="">교재를 선택하세요</option>
                            ${bookOptions}
                        </select>
                    </div>
                `;
                return;
            }
            
            const book = vocabularyData[currentBook];
            
            if (Object.keys(book.units).length === 0) {
                studyContent.innerHTML = `
                    <p>학습할 유닛이 없습니다. 먼저 유닛을 추가해주세요.</p>
                    <button class="btn btn-primary" onclick="setMode('edit')">원장님 모드로 이동</button>
                `;
                return;
            }
            
            const unitOptions = Object.keys(book.units)
                .sort((a, b) => parseInt(a) - parseInt(b))
                .map(unitNum => `
                    <option value="${unitNum}">Unit ${unitNum}: ${book.units[unitNum].title}</option>
                `).join('');
            
            studyContent.innerHTML = `
                <div class="form-group">
                    <label class="form-label">학습할 유닛 선택</label>
                    <select class="form-control" id="studyUnitSelect">
                        ${unitOptions}
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">학습 모드</label>
                    <select class="form-control" id="studyModeSelect">
                        <option value="flashcard">Flash Card</option>
                        <option value="listening">Listening</option>
                        <option value="spelling">Spelling</option>
                        <option value="quiz">Quiz</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="startStudySession()">학습 시작</button>
            `;
        }

        function selectStudyBook() {
            const bookSelect = document.getElementById('studyBookSelect');
            if (bookSelect && bookSelect.value) {
                currentBook = bookSelect.value;
                showStudyMode();
            }
        }

        function startStudySession() {
            const unitNum = document.getElementById('studyUnitSelect').value;
            const mode = document.getElementById('studyModeSelect').value;
            
            currentUnit = unitNum;
            
            switch(mode) {
                case 'flashcard':
                    startFlashcardMode();
                    break;
                case 'quiz':
                    startQuizMode();
                    break;
                case 'listening':
                    startListeningMode();
                    break;
                case 'spelling':
                    startSpellingMode();
                    break;
            }
        }

        function startFlashcardMode() {
            const unit = vocabularyData[currentBook]?.units?.[currentUnit];
            if (!unit || !unit.words || unit.words.length === 0) {
                document.getElementById('studyContent').innerHTML = `
                    <p>학습할 단어가 없습니다.</p>
                    <button class="btn btn-primary" onclick="showStudyMode()">돌아가기</button>
                `;
                return;
            }
            
            let currentIndex = 0;
            let showingAnswer = false;
            
            function showCard() {
                if (currentIndex >= unit.words.length) {
                    document.getElementById('studyContent').innerHTML = `
                        <h3>✅ Complete!</h3>
                        <p>You have studied all ${unit.words.length} words.</p>
                        <button class="btn btn-primary" onclick="showStudyMode()">Start Again</button>
                    `;
                    return;
                }
                
                const word = unit.words[currentIndex];
                const safeWord = (word.word || '').replace(/'/g, "\\'");
                
                document.getElementById('studyContent').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 2rem; font-weight: bold; color: #6366f1; margin-bottom: 20px;">
                            ${showingAnswer ? word.word : '?'}
                        </div>
                        <div style="font-size: 1.5rem; margin-bottom: 30px;">
                            ${showingAnswer ? word.meaning : word.word}
                        </div>
                        ${showingAnswer && word.example ? `
                            <div style="font-style: italic; color: #666; margin-bottom: 20px;">
                                ${word.example}
                            </div>
                        ` : ''}
                        <div style="margin-bottom: 20px;">
                            Progress: ${currentIndex + 1} / ${unit.words.length}
                        </div>
                        <div class="flex gap-2" style="justify-content: center;">
                            ${!showingAnswer ? `
                                <button class="btn btn-primary" onclick="speakWord('${safeWord}', this)">🔊 Listen</button>
                                <button class="btn btn-success" id="showAnswerBtn">Show Answer</button>
                            ` : `
                                <button class="btn btn-primary" id="nextCardBtn">Next →</button>
                            `}
                        </div>
                    </div>
                `;
                
                if (!showingAnswer) {
                    const showBtn = document.getElementById('showAnswerBtn');
                    if (showBtn) {
                        showBtn.onclick = () => {
                            showingAnswer = true;
                            showCard();
                        };
                    }
                } else {
                    const nextBtn = document.getElementById('nextCardBtn');
                    if (nextBtn) {
                        nextBtn.onclick = () => {
                            currentIndex++;
                            showingAnswer = false;
                            showCard();
                        };
                    }
                }
            }
            
            showCard();
        }

        function startQuizMode() {
            const unit = vocabularyData[currentBook]?.units?.[currentUnit];
            if (!unit || !unit.words || unit.words.length === 0) {
                document.getElementById('studyContent').innerHTML = `
                    <p>학습할 단어가 없습니다.</p>
                    <button class="btn btn-primary" onclick="showStudyMode()">돌아가기</button>
                `;
                return;
            }
            
            let currentIndex = 0;
            let correctCount = 0;
            
            function showQuiz() {
                if (currentIndex >= unit.words.length) {
                    const percentage = Math.round((correctCount / unit.words.length) * 100);
                    document.getElementById('studyContent').innerHTML = `
                        <h3>✅ Complete!</h3>
                        <p>Score: ${percentage}% (${correctCount}/${unit.words.length})</p>
                        <button class="btn btn-primary" onclick="showStudyMode()">Start Again</button>
                    `;
                    return;
                }
                
                const correctWord = unit.words[currentIndex];
                const options = generateQuizOptions(unit.words, currentIndex);
                
                document.getElementById('studyContent').innerHTML = `
                    <div style="padding: 20px;">
                        <h3>Question ${currentIndex + 1} / ${unit.words.length}</h3>
                        <p style="font-size: 1.2rem; margin: 20px 0;">
                            What is the meaning of <strong>"${correctWord.word}"</strong>?
                        </p>
                        <div id="quizOptions">
                            ${options.map((option, i) => `
                                <button class="btn btn-secondary" style="display: block; width: 100%; margin: 10px 0; text-align: left;"
                                        onclick="checkAnswer(${i}, ${option.isCorrect})">
                                    ${i + 1}. ${option.meaning}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            window.checkAnswer = (index, isCorrect) => {
                const buttons = document.querySelectorAll('#quizOptions button');
                buttons.forEach((btn, i) => {
                    btn.disabled = true;
                    if (i === index) {
                        btn.className = isCorrect ? 'btn btn-success' : 'btn btn-danger';
                    }
                });
                
                if (isCorrect) {
                    correctCount++;
                    showToast('Correct! ✅');
                } else {
                    showToast('Wrong! ❌', true);
                }
                
                setTimeout(() => {
                    currentIndex++;
                    showQuiz();
                }, 1500);
            };
            
            showQuiz();
        }

        function generateQuizOptions(words, correctIndex) {
            if (!words || words.length === 0) return [];
            
            const options = [];
            const correctWord = words[correctIndex];
            if (!correctWord || !correctWord.meaning) return [];
            
            options.push({ meaning: correctWord.meaning, isCorrect: true });
            
            const wrongIndices = [];
            const maxAttempts = words.length * 2;
            let attempts = 0;
            
            while (wrongIndices.length < 3 && wrongIndices.length < words.length - 1 && attempts < maxAttempts) {
                attempts++;
                const randomIndex = Math.floor(Math.random() * words.length);
                if (randomIndex !== correctIndex && 
                    !wrongIndices.includes(randomIndex) && 
                    words[randomIndex]?.meaning) {
                    wrongIndices.push(randomIndex);
                    options.push({ meaning: words[randomIndex].meaning, isCorrect: false });
                }
            }
            
            while (options.length < 4) {
                options.push({ meaning: `의미 ${options.length}`, isCorrect: false });
            }
            
            return options.sort(() => Math.random() - 0.5);
        }

        function startListeningMode() {
            const unit = vocabularyData[currentBook]?.units?.[currentUnit];
            if (!unit || !unit.words || unit.words.length === 0) {
                document.getElementById('studyContent').innerHTML = `
                    <p>학습할 단어가 없습니다.</p>
                    <button class="btn btn-primary" onclick="showStudyMode()">돌아가기</button>
                `;
                return;
            }
            
            let currentIndex = 0;
            
            function playWord() {
                if (currentIndex >= unit.words.length) {
                    document.getElementById('studyContent').innerHTML = `
                        <h3>✅ Complete!</h3>
                        <p>You have listened to all ${unit.words.length} words.</p>
                        <button class="btn btn-primary" onclick="showStudyMode()">Start Again</button>
                    `;
                    return;
                }
                
                const word = unit.words[currentIndex];
                const safeWord = (word.word || '').replace(/'/g, "\\'");
                
                document.getElementById('studyContent').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3>🎧 Listen and guess the meaning</h3>
                        <div style="margin: 30px 0;">
                            <button class="btn btn-primary" onclick="speakWord('${safeWord}', this)">
                                🔊 Play Again
                            </button>
                        </div>
                        <div id="answerArea" style="margin: 20px 0;">
                            <button class="btn btn-secondary" onclick="showListeningAnswer()">Show Answer</button>
                        </div>
                        <div style="margin-top: 20px; color: #666;">
                            Progress: ${currentIndex + 1} / ${unit.words.length}
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    const playBtn = document.querySelector('.btn-primary');
                    if (playBtn) {
                        speakWord(word.word, playBtn);
                    }
                }, 500);
            }
            
            window.showListeningAnswer = () => {
                const word = unit.words[currentIndex];
                document.getElementById('answerArea').innerHTML = `
                    <div style="font-size: 1.5rem; font-weight: bold; color: #6366f1; margin: 20px 0;">
                        ${word.word || ''}
                    </div>
                    <div style="font-size: 1.2rem; margin-bottom: 20px;">
                        ${word.meaning || ''}
                    </div>
                    ${word.example ? `
                        <div style="font-style: italic; color: #666; margin-bottom: 20px;">
                            Ex: ${word.example}
                        </div>
                    ` : ''}
                    <button class="btn btn-primary" onclick="nextListeningWord()">Next →</button>
                `;
            };
            
            window.nextListeningWord = () => {
                currentIndex++;
                playWord();
            };
            
            playWord();
        }

        function startSpellingMode() {
            const unit = vocabularyData[currentBook]?.units?.[currentUnit];
            if (!unit || !unit.words || unit.words.length === 0) {
                document.getElementById('studyContent').innerHTML = `
                    <p>학습할 단어가 없습니다.</p>
                    <button class="btn btn-primary" onclick="showStudyMode()">돌아가기</button>
                `;
                return;
            }
            
            let currentIndex = 0;
            let correctCount = 0;
            
            function showSpellingQuiz() {
                if (currentIndex >= unit.words.length) {
                    const percentage = Math.round((correctCount / unit.words.length) * 100);
                    document.getElementById('studyContent').innerHTML = `
                        <h3>✅ Complete!</h3>
                        <p>Score: ${percentage}% (${correctCount}/${unit.words.length})</p>
                        <button class="btn btn-primary" onclick="showStudyMode()">Start Again</button>
                    `;
                    return;
                }
                
                const correctWord = unit.words[currentIndex];
                const options = generateSpellingOptions(unit.words, currentIndex);
                
                document.getElementById('studyContent').innerHTML = `
                    <div style="padding: 20px;">
                        <h3>Question ${currentIndex + 1} / ${unit.words.length}</h3>
                        <p style="font-size: 1.2rem; margin: 20px 0;">
                            🎧 Listen and choose the correct spelling
                        </p>
                        <div style="margin: 30px 0;">
                            <button class="btn btn-primary" onclick="speakWord('${correctWord.word.replace(/'/g, "\\'")}', this)">
                                🔊 Play Again
                            </button>
                        </div>
                        <div style="margin: 20px 0; font-size: 1rem; color: #666;">
                            💡 Hint: ${correctWord.meaning || ''}
                        </div>
                        <div id="spellingOptions">
                            ${options.map((option, i) => `
                                <button class="btn btn-secondary" style="display: block; width: 100%; margin: 10px 0; text-align: left; font-size: 1.1rem;"
                                        onclick="checkSpelling(${i}, '${option.replace(/'/g, "\\'")}', '${correctWord.word.replace(/'/g, "\\'")}')">
                                    ${i + 1}. ${option}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    const playBtn = document.querySelector('.btn-primary');
                    if (playBtn) {
                        speakWord(correctWord.word, playBtn);
                    }
                }, 500);
            }
            
            window.checkSpelling = (index, selected, correct) => {
                const buttons = document.querySelectorAll('#spellingOptions button');
                const isCorrect = selected === correct;
                
                buttons.forEach((btn, i) => {
                    btn.disabled = true;
                    if (btn.textContent.includes(correct)) {
                        btn.className = 'btn btn-success';
                    } else if (i === index && !isCorrect) {
                        btn.className = 'btn btn-danger';
                    }
                });
                
                if (isCorrect) {
                    correctCount++;
                    showToast('Correct! ✅');
                } else {
                    showToast(`Wrong. The answer is "${correct}"`, true);
                }
                
                setTimeout(() => {
                    currentIndex++;
                    showSpellingQuiz();
                }, 2000);
            };
            
            showSpellingQuiz();
        }

        function generateSpellingOptions(words, correctIndex) {
            if (!words || words.length === 0) return [];
            
            const options = [];
            const correctWord = words[correctIndex]?.word || '';
            if (!correctWord) return [];
            
            const optionSet = new Set();
            optionSet.add(correctWord);
            
            const variations = [];
            
            if (correctWord.length > 3) {
                const lastChar = correctWord.charAt(correctWord.length - 1);
                if ('aeiou'.includes(lastChar)) {
                    variations.push(correctWord.slice(0, -1) + 'y');
                    variations.push(correctWord.slice(0, -1) + 'ie');
                } else {
                    variations.push(correctWord.slice(0, -1) + 'e');
                    if (lastChar !== 's') {
                        variations.push(correctWord.slice(0, -1) + 't');
                    }
                }
            }
            
            if (correctWord.length > 4) {
                const midIndex = Math.floor(correctWord.length / 2);
                const midChar = correctWord.charAt(midIndex);
                if ('aeiou'.includes(midChar)) {
                    const vowels = ['a', 'e', 'i', 'o', 'u'];
                    const otherVowels = vowels.filter(v => v !== midChar);
                    variations.push(
                        correctWord.substring(0, midIndex) + 
                        otherVowels[Math.floor(Math.random() * otherVowels.length)] + 
                        correctWord.substring(midIndex + 1)
                    );
                }
            }
            
            for (let i = 1; i < correctWord.length - 1; i++) {
                if (correctWord[i] === correctWord[i + 1]) {
                    variations.push(
                        correctWord.substring(0, i) + correctWord.substring(i + 1)
                    );
                    break;
                } else if (!'aeiou'.includes(correctWord[i])) {
                    variations.push(
                        correctWord.substring(0, i + 1) + correctWord[i] + correctWord.substring(i + 1)
                    );
                    break;
                }
            }
            
            if (correctWord.includes('ie')) {
                variations.push(correctWord.replace('ie', 'ei'));
            } else if (correctWord.includes('ei')) {
                variations.push(correctWord.replace('ei', 'ie'));
            }
            
            variations.forEach(v => {
                if (v && v !== correctWord && v.length > 2) {
                    optionSet.add(v);
                }
            });
            
            const similarLengthWords = words
                .filter((w, i) => {
                    return i !== correctIndex && 
                           w?.word && 
                           Math.abs(w.word.length - correctWord.length) <= 2;
                })
                .map(w => w.word)
                .sort(() => Math.random() - 0.5);
            
            for (const word of similarLengthWords) {
                if (optionSet.size >= 4) break;
                optionSet.add(word);
            }
            
            if (optionSet.size < 4) {
                const otherWords = words
                    .filter((w, i) => i !== correctIndex && w?.word && !optionSet.has(w.word))
                    .map(w => w.word)
                    .sort(() => Math.random() - 0.5);
                
                for (const word of otherWords) {
                    if (optionSet.size >= 4) break;
                    optionSet.add(word);
                }
            }
            
            const finalOptions = Array.from(optionSet).slice(0, 4);
            
            if (!finalOptions.includes(correctWord)) {
                finalOptions[0] = correctWord;
            }
            
            return finalOptions.sort(() => Math.random() - 0.5);
        }

        function exitStudyMode() {
            setMode('edit');
            if (currentBook) {
                showUnits();
            }
        }

        // Text-to-Speech Functions
        async function loadVoices() {
            return new Promise((resolve) => {
                const voices = speechSynthesis.getVoices();
                if (voices.length) {
                    resolve(voices);
                } else {
                    speechSynthesis.onvoiceschanged = () => {
                        resolve(speechSynthesis.getVoices());
                    };
                }
            });
        }

        async function selectBestVoice() {
            const voices = await loadVoices();
            
            const preferredVoices = [
                { name: 'Google US English', lang: 'en-US' },
                { name: 'Microsoft Zira', lang: 'en-US' },
                { name: 'Microsoft David', lang: 'en-US' },
                { name: 'Samantha', lang: 'en-US' },
                { name: 'Alex', lang: 'en-US' }
            ];
            
            for (const preferred of preferredVoices) {
                const voice = voices.find(v => 
                    v.name.includes(preferred.name) && 
                    v.lang.startsWith(preferred.lang.substring(0, 2))
                );
                if (voice) {
                    selectedVoice = voice;
                    console.log('Selected voice:', voice.name);
                    return voice;
                }
            }
            
            selectedVoice = voices.find(v => v.lang === 'en-US') || 
                          voices.find(v => v.lang.startsWith('en')) ||
                          voices[0];
            
            return selectedVoice;
        }

        async function speakWord(text, button = null) {
            try {
                if (!('speechSynthesis' in window) || !text) {
                    showToast('음성 기능을 지원하지 않는 브라우저입니다.', true);
                    return;
                }
                
                if (currentUtterance) {
                    speechSynthesis.cancel();
                }
                
                if (!selectedVoice) {
                    await selectBestVoice();
                }
                
                if (button) {
                    button.disabled = true;
                    button.classList.add('playing');
                    button.innerHTML = '⏸️ 재생 중...';
                }
                
                currentUtterance = new SpeechSynthesisUtterance(text);
                
                if (selectedVoice) {
                    currentUtterance.voice = selectedVoice;
                }
                
                currentUtterance.lang = 'en-US';
                currentUtterance.rate = speechRate;
                currentUtterance.pitch = speechPitch;
                currentUtterance.volume = 1.0;
                
                currentUtterance.onend = () => {
                    if (button) {
                        button.disabled = false;
                        button.classList.remove('playing');
                        button.innerHTML = '🔊 발음 듣기';
                    }
                    currentUtterance = null;
                };
                
                currentUtterance.onerror = (event) => {
                    console.error('Speech synthesis error:', event);
                    if (button) {
                        button.disabled = false;
                        button.classList.remove('playing');
                        button.innerHTML = '🔊 발음 듣기';
                    }
                    showToast('음성 재생 중 오류가 발생했습니다.', true);
                    currentUtterance = null;
                };
                
                speechSynthesis.speak(currentUtterance);
                
            } catch (error) {
                console.error('Speech error:', error);
                if (button) {
                    button.disabled = false;
                    button.classList.remove('playing');
                    button.innerHTML = '🔊 발음 듣기';
                }
                showToast('음성 재생 중 오류가 발생했습니다.', true);
            }
        }

        async function speakSentence(text, button = null) {
            try {
                if (!('speechSynthesis' in window) || !text) {
                    showToast('음성 기능을 지원하지 않는 브라우저입니다.', true);
                    return;
                }
                
                if (currentUtterance) {
                    speechSynthesis.cancel();
                }
                
                if (!selectedVoice) {
                    await selectBestVoice();
                }
                
                if (button) {
                    button.disabled = true;
                    button.classList.add('playing');
                    button.innerHTML = '⏸️ 재생 중...';
                }
                
                currentUtterance = new SpeechSynthesisUtterance(text);
                
                if (selectedVoice) {
                    currentUtterance.voice = selectedVoice;
                }
                
                currentUtterance.lang = 'en-US';
                currentUtterance.rate = 0.95;
                currentUtterance.pitch = 0.95;
                currentUtterance.volume = 1.0;
                
                currentUtterance.onend = () => {
                    if (button) {
                        button.disabled = false;
                        button.classList.remove('playing');
                        button.innerHTML = '📢 예문 듣기';
                    }
                    currentUtterance = null;
                };
                
                currentUtterance.onerror = (event) => {
                    console.error('Speech synthesis error:', event);
                    if (button) {
                        button.disabled = false;
                        button.classList.remove('playing');
                        button.innerHTML = '📢 예문 듣기';
                    }
                    showToast('음성 재생 중 오류가 발생했습니다.', true);
                    currentUtterance = null;
                };
                
                speechSynthesis.speak(currentUtterance);
                
            } catch (error) {
                console.error('Speech error:', error);
                if (button) {
                    button.disabled = false;
                    button.classList.remove('playing');
                    button.innerHTML = '📢 예문 듣기';
                }
                showToast('음성 재생 중 오류가 발생했습니다.', true);
            }
        }

        function loadSpeechSettings() {
            const savedRate = localStorage.getItem('speechRate');
            const savedPitch = localStorage.getItem('speechPitch');
            
            if (savedRate) speechRate = parseFloat(savedRate);
            if (savedPitch) speechPitch = parseFloat(savedPitch);
        }

        function setupSpeechControls() {
            const rateSlider = document.getElementById('speechRateSlider');
            const pitchSlider = document.getElementById('speechPitchSlider');
            const rateValue = document.getElementById('speechRateValue');
            const pitchValue = document.getElementById('speechPitchValue');
            
            if (rateSlider && rateValue) {
                rateSlider.value = speechRate;
                rateValue.textContent = Math.round(speechRate * 100) + '%';
                
                rateSlider.addEventListener('input', function() {
                    speechRate = parseFloat(this.value);
                    rateValue.textContent = Math.round(speechRate * 100) + '%';
                    localStorage.setItem('speechRate', speechRate);
                });
            }
            
            if (pitchSlider && pitchValue) {
                pitchSlider.value = speechPitch;
                pitchValue.textContent = Math.round(speechPitch * 100) + '%';
                
                pitchSlider.addEventListener('input', function() {
                    speechPitch = parseFloat(this.value);
                    pitchValue.textContent = Math.round(speechPitch * 100) + '%';
                    localStorage.setItem('speechPitch', speechPitch);
                });
            }
        }

        function toggleSpeechSettings() {
            const settings = document.getElementById('speechSettings');
            if (settings) {
                settings.style.display = settings.style.display === 'none' ? 'block' : 'none';
            }
        }

        function testSpeech() {
            speakWord('Hello, this is a test', null);
        }

        function resetSpeechSettings() {
            speechRate = 0.85;
            speechPitch = 1.0;
            
            const rateSlider = document.getElementById('speechRateSlider');
            const pitchSlider = document.getElementById('speechPitchSlider');
            const rateValue = document.getElementById('speechRateValue');
            const pitchValue = document.getElementById('speechPitchValue');
            
            if (rateSlider) {
                rateSlider.value = speechRate;
                rateValue.textContent = '85%';
            }
            
            if (pitchSlider) {
                pitchSlider.value = speechPitch;
                pitchValue.textContent = '100%';
            }
            
            localStorage.setItem('speechRate', speechRate);
            localStorage.setItem('speechPitch', speechPitch);
            
            showToast('음성 설정이 초기화되었습니다.');
        }

        // UI Helper Functions
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            if (!toast) return;
            
            toast.textContent = message;
            toast.className = isError ? 'toast error' : 'toast';
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        function showLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'flex';
            }
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function closeAllModals() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
        }

        // Click outside to close modals
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>